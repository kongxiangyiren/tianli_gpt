(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(":root{--heo-white: #fff;--heo-white-op: rgba(255, 255, 255, .2);--heo-black: #000;--heo-black-op: rgba(0, 0, 0, .2);--heo-none: #00000000;--heo-gray: #999999;--heo-gray-op: #9999992b;--heo-vip: #e5a80d;--heo-main: var(--heo-theme);--heo-main-op: var(--heo-theme-op);--heo-main-op-deep: var(--heo-theme-op-deep);--heo-main-none: var(--heo-theme-none);--heo-shadow-theme: 0 8px 12px -3px var(--heo-theme-op);--heo-shadow-blackdeep: 0 2px 16px -3px rgba(0, 0, 0, .15);--heo-shadow-main: 0 8px 12px -3px var(--heo-main-op);--heo-shadow-blue: 0 8px 12px -3px rgba(40, 109, 234, .2);--heo-shadow-white: 0 8px 12px -3px rgba(255, 255, 255, .2);--heo-shadow-black: 0 0 12px 4px rgba(0, 0, 0, .05);--heo-shadow-yellow: 0px 38px 77px -26px rgba(255, 201, 62, .12);--heo-shadow-red: 0 8px 12px -3px #ee7d7936;--heo-shadow-green: 0 8px 12px -3px #87ee7936;--heo-logo-color: linear-gradient(215deg, #4584ff 0%, #cf0db9 100%);--heo-snackbar-time: 5s;--heo-theme: #425AEF;--heo-theme-op: #4259ef23;--heo-theme-op-deep: #4259efdd;--heo-theme-none: #4259ef01;--heo-blue: #425AEF;--heo-red: #f04a63;--heo-pink: #FF7C7C;--heo-green: #57bd6a;--heo-yellow: #c28b00;--heo-yellow-op: #d99c001a;--heo-orange: #e38100;--heo-fontcolor: #363636;--heo-background: #f7f9fe;--heo-reverse: #000;--heo-maskbg: rgba(255, 255, 255, .6);--heo-maskbgdeep: rgba(255, 255, 255, .85);--heo-hovertext: var(--heo-main);--heo-ahoverbg: #F7F7FA;--heo-lighttext: var(--heo-main);--heo-secondtext: rgba(60, 60, 67, .8);--heo-scrollbar: rgba(60, 60, 67, .4);--heo-card-btn-bg: #edf0f7;--heo-post-blockquote-bg: #fafcff;--heo-post-tabs-bg: #f2f5f8;--heo-secondbg: #f1f3f8;--heo-shadow-nav: 0 5px 12px -5px rgba(102, 68, 68, .05);--heo-card-bg: #fff;--heo-card-bg-op: var(--heo-black-op);--heo-card-bg-none: rgba(255, 255, 255, 0);--heo-shadow-lightblack: 0 5px 12px -5px rgba(102, 68, 68, 0);--heo-shadow-light2black: 0 5px 12px -5px rgba(102, 68, 68, 0);--heo-card-border: #e3e8f7;--heo-shadow-border: 0 8px 16px -4px #2c2d300c;--style-border: 1px solid var(--heo-card-border);--style-border-always: 1px solid var(--heo-card-border);--style-border-hover: 1px solid var(--heo-main);--style-border-hover-always: 1px solid var(--heo-main);--style-border-dashed: 1px dashed var(--heo-theme-op);--style-border-forever: 2px solid var(--heo-main)}[data-theme=light]{--heo-theme: #425AEF;--heo-theme-op: #4259ef23;--heo-theme-op-deep: #4259efdd;--heo-theme-none: #4259ef01;--heo-blue: #425AEF;--heo-red: #f04a63;--heo-pink: #FF7C7C;--heo-green: #57bd6a;--heo-yellow: #c28b00;--heo-yellow-op: #d99c001a;--heo-orange: #e38100;--heo-fontcolor: #363636;--heo-background: #f7f9fe;--heo-reverse: #000;--heo-maskbg: rgba(255, 255, 255, .6);--heo-maskbgdeep: rgba(255, 255, 255, .85);--heo-hovertext: var(--heo-main);--heo-ahoverbg: #F7F7FA;--heo-lighttext: var(--heo-main);--heo-secondtext: rgba(60, 60, 67, .8);--heo-scrollbar: rgba(60, 60, 67, .4);--heo-card-btn-bg: #edf0f7;--heo-post-blockquote-bg: #fafcff;--heo-post-tabs-bg: #f2f5f8;--heo-secondbg: #f1f3f8;--heo-shadow-nav: 0 5px 12px -5px rgba(102, 68, 68, .05);--heo-card-bg: #fff;--heo-card-bg-op: var(--heo-black-op);--heo-card-bg-none: rgba(255, 255, 255, 0);--heo-shadow-lightblack: 0 5px 12px -5px rgba(102, 68, 68, 0);--heo-shadow-light2black: 0 5px 12px -5px rgba(102, 68, 68, 0);--heo-card-border: #e3e8f7;--heo-shadow-border: 0 8px 16px -4px #2c2d300c;--style-border: 1px solid var(--heo-card-border);--style-border-always: 1px solid var(--heo-card-border);--style-border-hover: 1px solid var(--heo-main);--style-border-hover-always: 1px solid var(--heo-main);--style-border-dashed: 1px dashed var(--heo-theme-op);--style-border-forever: 2px solid var(--heo-main)}[data-theme=dark],body.dark,body.dark-theme{--heo-theme: #f2b94b;--heo-theme-op: #f2b94b23;--heo-theme-op-deep: #f2b94bdd;--heo-theme-none: #f2b94b00;--heo-blue: #0084FF;--heo-red: #FF3842;--heo-pink: #d44040;--heo-green: #3e9f50;--heo-yellow: #ffc93e;--heo-yellow-op: #ffc93e30;--heo-orange: #ff953e;--heo-fontcolor: #F7F7FA;--heo-background: #18171d;--heo-reverse: #fff;--heo-maskbg: rgba(0, 0, 0, .6);--heo-maskbgdeep: rgba(0, 0, 0, .85);--heo-hovertext: #0A84FF;--heo-ahoverbg: #fff;--heo-lighttext: var(--heo-theme);--heo-secondtext: #a1a2b8;--heo-scrollbar: rgba(200, 200, 223, .4);--heo-card-btn-bg: #30343f;--heo-post-blockquote-bg: #000;--heo-post-tabs-bg: #121212;--heo-secondbg: #30343f;--heo-shadow-nav: 0 5px 20px 0px rgba(28, 28, 28, .4);--heo-card-bg: #1d1e22;--heo-card-bg-op: var(--heo-white-op);--heo-card-bg-none: #1d1b2600;--heo-shadow-lightblack: 0 5px 12px -5px rgba(102, 68, 68, 0);--heo-shadow-light2black: 0 5px 12px -5px rgba(102, 68, 68, 0);--heo-card-border: #3d3d3f;--heo-shadow-border: 0 8px 16px -4px #00000050;--style-border: 1px solid var(--heo-card-border);--style-border-always: 1px solid var(--heo-card-border);--style-border-hover: 1px solid var(--heo-theme);--style-border-hover-always: 1px solid var(--heo-theme);--style-border-dashed: 1px dashed var(--heo-theme-op);--style-border-forever: 2px solid var(--heo-lighttext)}.post-TianliGPT{background:var(--heo-secondbg);border-radius:12px;padding:12px;line-height:1.3;border:var(--style-border-always);margin:16px 0}@media screen and (max-width: 768px){.post-TianliGPT{margin-top:22px}}.tianliGPT-title{display:flex;color:var(--heo-lighttext);border-radius:8px;align-items:center;padding:0 12px;cursor:default;-webkit-user-select:none;user-select:none;position:relative}.tianliGPT-title-text{font-weight:700;margin-left:8px;line-height:1}.tianliGPT-explanation{margin-top:12px;padding:8px 12px;background:var(--heo-card-bg);border-radius:8px;border:var(--style-border-always);font-size:15px;line-height:1.4;display:flex}.tianliGPT-suggestions{display:flex;flex-wrap:wrap}.tianliGPT-suggestions .tianliGPT-suggestions-item{margin-top:12px;padding:8px 12px;background:var(--heo-card-bg);border-radius:8px 8px 8px 0;border:var(--style-border-always);font-size:15px;line-height:1.4;display:flex;width:fit-content;margin-right:12px;cursor:pointer;transition:.3s}.tianliGPT-suggestions .tianliGPT-suggestions-item:hover{background:var(--heo-main);color:var(--heo-white)}.blinking-cursor{background-color:var(--heo-main);width:10px;height:16px;display:inline-block;vertical-align:middle;animation:blinking-cursor .5s infinite;-webkit-animation:blinking-cursor .5s infinite;margin-left:4px}@keyframes blinking-cursor{0%{opacity:1}40%{opacity:1}50%{opacity:0}90%{opacity:0}to{opacity:1}}.tianliGPT-tag{font-size:12px;background-color:var(--heo-lighttext);color:var(--heo-card-bg);font-weight:700;border-radius:4px;margin-left:auto;line-height:1;padding:4px;display:flex;align-items:center;justify-content:center;transition:all .3s,background-color 0s;position:absolute;right:12px}ins.adsbygoogle{margin:16px 0;background:var(--heo-card-bg);border-radius:12px;overflow:hidden;border:var(--style-border-always)}#tianliGPT-Toggle{font-size:12px;background:var(--heo-lighttext);color:var(--heo-card-bg);padding:4px;border-radius:4px;margin-left:6px;transform:scale(.8);cursor:pointer;transition:.3s;font-weight:700}#tianliGPT-Toggle:hover{background:var(--heo-fontcolor);color:var(--heo-card-bg)}.tianliGPT-title-icon{width:20px;height:20px}.tianliGPT-title-icon svg{width:20px;height:20px;fill:var(--heo-main)}.tianliGPT-title-icon svg path{fill:var(--heo-main)}.tianliGPT-tag svg{fill:#7e8a97}@keyframes breathe{0%{-webkit-transform:scale(.97);-moz-transform:scale(.97);-o-transform:scale(.97);-ms-transform:scale(.97);transform:scale(.97)}50%{-webkit-transform:scale(1.1);-moz-transform:scale(1.1);-o-transform:scale(1.1);-ms-transform:scale(1.1);transform:scale(1.1)}to{-webkit-transform:scale(.97);-moz-transform:scale(.97);-o-transform:scale(.97);-ms-transform:scale(.97);transform:scale(.97)}}.tianliGPT-tag.playing svg{animation:.5s linear 0s infinite normal none running breathe;transform-origin:center;width:20px;height:20px}")),document.head.appendChild(e)}}catch(o){console.error("vite-plugin-css-injected-by-js",o)}})();
const A = '<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><g id="机器人" fill="none" fill-rule="evenodd" stroke="none" stroke-width="1"><path id="形状结合" fill="#444" fill-rule="nonzero" d="M34.718 5.036a2.59 2.59 0 0 1 2.127 2.977l-1.05 6.302h2.58A8.625 8.625 0 0 1 47 22.94v11.5a8.625 8.625 0 0 1-8.625 8.625H9.625A8.625 8.625 0 0 1 1 34.44v-11.5a8.625 8.625 0 0 1 8.625-8.625h2.58l-1.05-6.302a2.588 2.588 0 0 1 5.105-.85l1.15 6.9q.021.127.03.252h13.12q.009-.126.03-.253l1.15-6.9a2.59 2.59 0 0 1 2.978-2.126m3.657 14.454H9.625a3.45 3.45 0 0 0-3.45 3.45v11.5a3.45 3.45 0 0 0 3.45 3.45h28.75a3.45 3.45 0 0 0 3.45-3.45v-11.5a3.45 3.45 0 0 0-3.45-3.45m-23.517 4.313a2.59 2.59 0 0 1 2.587 2.587v2.3a2.588 2.588 0 0 1-5.175 0v-2.3a2.59 2.59 0 0 1 2.588-2.587m18.284 0a2.59 2.59 0 0 1 2.588 2.587v2.3a2.588 2.588 0 0 1-5.175 0v-2.3a2.59 2.59 0 0 1 2.587-2.587"/></g></svg>';
console.log(
  `
 %c Post-Abstract-AI 开源博客文章摘要AI生成工具 %c https://github.com/zhheo/Post-Abstract-AI 
`,
  "color: #fadfa3; background: #030307; padding:5px 0;",
  "background: #fadfa3; padding:5px 0;"
);
function w(i) {
  let c = !1;
  function a(t) {
    T();
    const n = document.querySelector(t);
    if (!n)
      return;
    const l = document.createElement("div");
    l.className = "post-TianliGPT";
    const r = document.createElement("div");
    r.className = "tianliGPT-title", l.appendChild(r);
    const e = document.createElement("i");
    e.className = "tianliGPT-title-icon", r.appendChild(e), e.innerHTML = A;
    const o = document.createElement("div");
    o.className = "tianliGPT-title-text", o.textContent = "AI摘要", r.appendChild(o);
    const s = document.createElement("div");
    s.className = "tianliGPT-tag", s.id = "tianliGPT-tag", s.textContent = "TianliGPT", r.appendChild(s);
    const u = document.createElement("div");
    u.className = "tianliGPT-explanation", u.innerHTML = '生成中...<span class="blinking-cursor"></span>', l.appendChild(u), n.insertBefore(l, n.firstChild);
  }
  function T() {
    var n;
    const t = document.querySelector(".post-TianliGPT");
    t && ((n = t.parentElement) == null || n.removeChild(t));
  }
  const m = {
    //读取文章中的所有文本
    getTitleAndContent: function() {
      try {
        const t = document.title, n = document.querySelector(tianliGPT_postSelector);
        if (!n)
          return console.warn(
            "TianliGPT：找不到文章容器。请尝试将引入的代码放入到文章容器之后。如果本身没有打算使用摘要功能可以忽略此提示。"
          ), "";
        const l = n.getElementsByTagName("p"), r = n.querySelectorAll("h1, h2, h3, h4, h5");
        let e = "";
        for (let p of r)
          e += p.innerText + " ";
        for (let p of l) {
          const f = p.innerText.replace(/https?:\/\/[^\s]+/g, "");
          e += f;
        }
        const o = t + " " + e;
        let s = 1e3;
        return typeof tianliGPT_wordLimit < "u" && (s = tianliGPT_wordLimit), o.slice(0, s);
      } catch (t) {
        return console.error(
          "TianliGPT错误：可能由于一个或多个错误导致没有正常运行，原因出在获取文章容器中的内容失败，或者可能是在文章转换过程中失败。",
          t
        ), "";
      }
    },
    fetchTianliGPT: async function(t) {
      if (!tianliGPT_key)
        return "没有获取到key，代码可能没有安装正确。如果你需要在tianli_gpt文件引用前定义tianliGPT_key变量。详细请查看文档。";
      if (tianliGPT_key === "5Q5mpqRK5DkwT1X9Gi5e")
        return "请购买 key 使用，如果你能看到此条内容，则说明代码安装正确。";
      const n = window.location.href, l = document.title, r = `https://summary.tianli0.top/?content=${encodeURIComponent(
        t
      )}&key=${encodeURIComponent(tianliGPT_key)}&url=${encodeURIComponent(
        n
      )}&title=${encodeURIComponent(l)}`;
      try {
        const e = new AbortController(), o = await fetch(r, { signal: e.signal });
        if (o.ok) {
          const s = await o.json();
          return {
            summary: s.summary,
            audioId: s.id
            // 获取音频的 ID
          };
        } else
          throw o.status === 402 && document.querySelectorAll(".post-TianliGPT").forEach((s) => {
            s.style.display = "none";
          }), new Error("TianliGPT：余额不足，请充值后请求新的文章");
      } catch (e) {
        return e.name === "AbortError" ? window.location.hostname === "localhost" ? (console.warn("警告：请勿在本地主机上测试 API 密钥。"), "获取文章摘要超时。请勿在本地主机上测试 API 密钥。") : (console.error("请求超时"), "获取文章摘要超时。当你出现这个问题时，可能是key或者绑定的域名不正确。也可能是因为文章过长导致的 AI 运算量过大，您可以稍等一下然后刷新页面重试。") : (console.error("请求失败：", e), "获取文章摘要失败，请稍后再试。");
      }
    },
    aiShowAnimation: function(t = "") {
      const n = document.querySelector(".tianliGPT-explanation");
      if (!n || c)
        return;
      if (typeof tianliGPT_typingAnimate < "u" && !tianliGPT_typingAnimate) {
        n.innerHTML = t;
        return;
      }
      c = !0;
      const l = 25, r = 6;
      n.style.display = "block", n.innerHTML = '生成中...<span class="blinking-cursor"></span>';
      let e = !0, o = 0, s = !0, u = performance.now();
      const p = () => {
        if (o < t.length && e) {
          const g = performance.now(), P = g - u, L = t.slice(o, o + 1), k = /[，。！、？,.!?]/.test(L) ? l * r : l;
          P >= k && (n.innerText = t.slice(0, o + 1), u = g, o++, o < t.length ? n.innerHTML = t.slice(0, o) + '<span class="blinking-cursor"></span>' : (n.innerHTML = t, n.style.display = "block", c = !1, f.disconnect())), requestAnimationFrame(p);
        }
      }, f = new IntersectionObserver(
        (g) => {
          e = g[0].isIntersecting, e && s && setTimeout(() => {
            requestAnimationFrame(p);
          }, 200);
        },
        { threshold: 0 }
      );
      let v = document.querySelector(".post-TianliGPT");
      v && f.observe(v);
    }
  };
  function y() {
    a(tianliGPT_postSelector);
    const t = m.getTitleAndContent();
    t && console.log("TianliGPT本次提交的内容为：" + t), m.fetchTianliGPT(t).then((n) => {
      const l = n.summary, r = n.audioId, e = document.querySelector(".tianliGPT-tag");
      e && (e.dataset.audioId = r, m.aiShowAnimation(l));
    });
  }
  function h() {
    if (typeof tianliGPT_postURL > "u") {
      y();
      return;
    }
    try {
      const t = (e) => new RegExp("^" + e.split(/\*+/).map(n).join(".*") + "$"), n = (e) => e.replace(/[|\\{}()[\]^$+*?.]/g, "\\{{input}}"), l = t(tianliGPT_postURL), r = window.location.href;
      l.test(r) ? y() : console.log("TianliGPT：因为不符合自定义的链接规则，我决定不执行摘要功能。");
    } catch (t) {
      console.error("TianliGPT：我没有看懂你编写的自定义链接规则，所以我决定不执行摘要功能", t);
    }
  }
  i ? h() : document.addEventListener("DOMContentLoaded", function() {
    h();
  });
}
w(!1);
document.addEventListener("pjax:complete", function() {
  w(!0);
});
document.addEventListener("click", function(i) {
  const c = i.target;
  c && c.classList.contains("tianliGPT-tag") && G();
});
let d = null;
function G() {
  if (d && !d.paused)
    d.pause();
  else {
    if (!d) {
      const a = document.querySelector(".tianliGPT-tag");
      if (!a)
        return;
      const T = a.dataset.audioId;
      if (!T) {
        console.error("未找到音频 ID");
        return;
      }
      const m = `https://summary.tianli0.top/audio?id=${encodeURIComponent(
        T
      )}&key=${encodeURIComponent(tianliGPT_key)}`;
      d = new Audio(m), d.addEventListener("ended", () => {
        a.classList.remove("playing");
      }), d.addEventListener("play", () => {
        a.classList.add("playing");
      }), d.addEventListener("pause", () => {
        a.classList.remove("playing");
      });
    }
    setTimeout(() => {
      d == null || d.play().catch((a) => {
        console.error("播放音频失败:", a);
      });
    }, 100);
  }
  const i = document.querySelector(".tianliGPT-tag");
  if (!i)
    return;
  i.addEventListener("click", function() {
    i.classList.toggle("playing");
  });
  const c = '<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1692880829044" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2346" data-darkreader-inline-fill="" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="20"><path d="M512 1024a512 512 0 1 0 0-1024 512 512 0 1 0 0 1024z m0-704a192 192 0 1 1 0 384 192 192 0 1 1 0-384z" p-id="2347"></path></svg>';
  i.classList.contains("playing") ? (i.innerHTML = c, i.style.animation = "", i.style.color = "#ff0000", i.style.backgroundColor = "transparent", i.style.padding = "0") : (i.innerHTML = c, i.style.animation = "", i.style.color = "#000000", i.style.backgroundColor = "transparent", i.style.padding = "0");
}
document.addEventListener("click", function(i) {
  const c = i.target, a = document.querySelector(".tianliGPT-tag");
  a && (a.addEventListener("click", function() {
    a.classList.toggle("playing");
  }), (c === a || a.contains(c)) && G());
});
